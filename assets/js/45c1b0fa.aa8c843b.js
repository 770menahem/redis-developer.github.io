"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[4001],{85162:(e,a,n)=>{n.d(a,{Z:()=>r});var t=n(67294),i=n(86010);const s="tabItem_Ymn6";function r(e){let{children:a,hidden:n,className:r}=e;return t.createElement("div",{role:"tabpanel",className:(0,i.Z)(s,r),hidden:n},a)}},65488:(e,a,n)=>{n.d(a,{Z:()=>h});var t=n(87462),i=n(67294),s=n(86010),r=n(72389),o=n(67392),l=n(7094),c=n(12466);const d="tabList__CuJ",u="tabItem_LNqP";function p(e){var a;const{lazy:n,block:r,defaultValue:p,values:h,groupId:m,className:g}=e,v=i.Children.map(e.children,(e=>{if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=h??v.map((e=>{let{props:{value:a,label:n,attributes:t}}=e;return{value:a,label:n,attributes:t}})),k=(0,o.l)(b,((e,a)=>e.value===a.value));if(k.length>0)throw new Error(`Docusaurus error: Duplicate values "${k.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const f=null===p?p:p??(null==(a=v.find((e=>e.props.default)))?void 0:a.props.value)??v[0].props.value;if(null!==f&&!b.some((e=>e.value===f)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${f}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:C,setTabGroupChoices:w}=(0,l.U)(),[N,R]=(0,i.useState)(f),y=[],{blockElementScrollPositionUntilNextRender:E}=(0,c.o5)();if(null!=m){const e=C[m];null!=e&&e!==N&&b.some((a=>a.value===e))&&R(e)}const _=e=>{const a=e.currentTarget,n=y.indexOf(a),t=b[n].value;t!==N&&(E(a),R(t),null!=m&&w(m,String(t)))},S=e=>{var a;let n=null;switch(e.key){case"Enter":_(e);break;case"ArrowRight":{const a=y.indexOf(e.currentTarget)+1;n=y[a]??y[0];break}case"ArrowLeft":{const a=y.indexOf(e.currentTarget)-1;n=y[a]??y[y.length-1];break}}null==(a=n)||a.focus()};return i.createElement("div",{className:(0,s.Z)("tabs-container",d)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":r},g)},b.map((e=>{let{value:a,label:n,attributes:r}=e;return i.createElement("li",(0,t.Z)({role:"tab",tabIndex:N===a?0:-1,"aria-selected":N===a,key:a,ref:e=>y.push(e),onKeyDown:S,onClick:_},r,{className:(0,s.Z)("tabs__item",u,null==r?void 0:r.className,{"tabs__item--active":N===a})}),n??a)}))),n?(0,i.cloneElement)(v.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},v.map(((e,a)=>(0,i.cloneElement)(e,{key:a,hidden:e.props.value!==N})))))}function h(e){const a=(0,r.Z)();return i.createElement(p,(0,t.Z)({key:String(a)},e))}},71131:(e,a,n)=>{n.d(a,{Z:()=>m});var t=n(67294),i=n(3905),s=n(52195);const r="riContainer_bco2",o="riDescriptionShort_E27B",l="riDetail_wzFs",c="riIcon_yDou",d="riTitle_x6vI",u="riDescription_RDnu",p="riMore_apRP";var h=n(86010);const m=e=>{const[a,n]=t.useState(!1);return t.createElement("a",{href:e.page,className:r},t.createElement("div",{className:o},t.createElement("div",{className:c},t.createElement("span",{className:"fe fe-zap"})),t.createElement("div",{className:l},t.createElement("div",{className:d},t.createElement("a",{href:e.page},e.title)),t.createElement("div",{className:u},e.description,t.Children.count(e.children)>0&&t.createElement("span",{className:(0,h.Z)(p,"fe","fe-more-horizontal"),onClick:()=>n(!a)})))),a&&t.createElement("div",{className:"ri-description-long"},t.createElement(i.Zo,{components:s.Z},e.children)))}},99682:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var t=n(87462),i=(n(67294),n(3905));n(71131),n(65488),n(85162),n(44996);const s={id:"index-lesson_9",title:"Caching REST Services with Redis",sidebar_label:"Caching w/ Redis",slug:"/develop/java/redis-and-spring-course/lesson_9",authors:["bsb"]},r=void 0,o={unversionedId:"develop/java/spring/redis-and-spring-course/lesson_9/index-lesson_9",id:"develop/java/spring/redis-and-spring-course/lesson_9/index-lesson_9",title:"Caching REST Services with Redis",description:"Objectives",source:"@site/docs/develop/java/spring/redis-and-spring-course/lesson_9/index-lesson_9.mdx",sourceDirName:"develop/java/spring/redis-and-spring-course/lesson_9",slug:"/develop/java/redis-and-spring-course/lesson_9",permalink:"/develop/java/redis-and-spring-course/lesson_9",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/develop/java/spring/redis-and-spring-course/lesson_9/index-lesson_9.mdx",tags:[],version:"current",lastUpdatedAt:1655485542,formattedLastUpdatedAt:"Jun 17, 2022",frontMatter:{id:"index-lesson_9",title:"Caching REST Services with Redis",sidebar_label:"Caching w/ Redis",slug:"/develop/java/redis-and-spring-course/lesson_9",authors:["bsb"]},sidebar:"docs",previous:{title:"Recommendations w/ RedisGraph",permalink:"/develop/java/redis-and-spring-course/lesson_8"},next:{title:"Overview",permalink:"/develop/java/spring/rate-limiting"}},l={},c=[{value:"Objectives",id:"objectives",level:3},{value:"Agenda",id:"agenda",level:3},{value:"Spring-Redis Caching Recipe",id:"spring-redis-caching-recipe",level:3},{value:"Using the @Cacheable annotation",id:"using-the-cacheable-annotation",level:3}],d={toc:c};function u(e){let{components:a,...s}=e;return(0,i.kt)("wrapper",(0,t.Z)({},d,s,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"objectives"},"Objectives"),(0,i.kt)("p",null,"Learn how easy it is to use Redis as a cache in your Spring applications"),(0,i.kt)("h3",{id:"agenda"},"Agenda"),(0,i.kt)("p",null,"In this lesson, students will learn:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The basics of Caching RESTful Services"),(0,i.kt)("li",{parentName:"ul"},"How to configure the Spring Data Redis ",(0,i.kt)("inlineCode",{parentName:"li"},"RedisCacheManager")," using ",(0,i.kt)("inlineCode",{parentName:"li"},"RedisCacheConfiguration")),(0,i.kt)("li",{parentName:"ul"},"How to use the ",(0,i.kt)("inlineCode",{parentName:"li"},"@Cacheable")," annotation to mark a REST controller response as cacheable\nIf you get stuck:"),(0,i.kt)("li",{parentName:"ul"},"The progress made in this lesson is available on the redi2read github repository at ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/redis-developer/redi2read/tree/course/milestone-9"},"https://github.com/redis-developer/redi2read/tree/course/milestone-9"))),(0,i.kt)("h3",{id:"spring-redis-caching-recipe"},"Spring-Redis Caching Recipe"),(0,i.kt)("p",null,"To implement caching in our Spring Boot application:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Configure the Redis cache manager"),(0,i.kt)("li",{parentName:"ul"},"Enable application-wide caching with the ",(0,i.kt)("inlineCode",{parentName:"li"},"@EnableCaching")," annotation")),(0,i.kt)("p",null,"In the main application file (",(0,i.kt)("inlineCode",{parentName:"p"},"src/main/java/com/redislabs/edu/redi2read/Redi2readApplication.java"),"), add the ",(0,i.kt)("inlineCode",{parentName:"p"},"cacheManager")," method as shown:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableCaching\npublic class Redi2readApplication {\n\n  // ...\n\n  @Bean\n  public RedisCacheManager cacheManager(RedisConnectionFactory connectionFactory) {\n    RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig() //\n        .prefixCacheNameWith(this.getClass().getPackageName() + ".") //\n        .entryTtl(Duration.ofHours(1)) //\n        .disableCachingNullValues();\n\n    return RedisCacheManager.builder(connectionFactory) //\n        .cacheDefaults(config) //\n        .build();\n  }\n\n  // ...\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"cacheManager")," method takes an instance of the ",(0,i.kt)("inlineCode",{parentName:"p"},"RedisConnectionFactory"),". In it we will configure our cache to use a Redis\nkey prefix equals to our application\u2019s main package plus a period, that is ",(0,i.kt)("inlineCode",{parentName:"p"},"com.redislabs.edu.redi2read."),"\nWe also set the TTL or \u201cTime to Live\u201d of our cache entries to 1 hour and make sure that we don\u2019t cache nulls.\nAt the class level, we also use the annotation ",(0,i.kt)("inlineCode",{parentName:"p"},"@EnableCaching "),"to globally enable caching for our applications.\nThe changes above will need the import statements shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"import org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.data.redis.cache.RedisCacheConfiguration;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport java.time.Duration;\n")),(0,i.kt)("h3",{id:"using-the-cacheable-annotation"},"Using the @Cacheable annotation"),(0,i.kt)("p",null,"In the context of a RESTful service, caching makes sense at the handoff between the application and the HTTP protocol.\nIt seems almost silly to think about caching anything in an application powered by Redis, but complex business logic\ntouching many data repositories and performing intense calculations can add to your response\u2019s latency.\nThe ideal place to perform this caching is at the controller level. For example, let\u2019s say that we wanted to cache\nthe responses of our book searches in the ",(0,i.kt)("inlineCode",{parentName:"p"},"BookController"),". We could simple add the ",(0,i.kt)("inlineCode",{parentName:"p"},"@Cacheable")," annotation as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@GetMapping("/search")\n@Cacheable("book-search")\npublic SearchResults<String,String> search(@RequestParam(name="q")String query) {\n  RediSearchCommands<String, String> commands = searchConnection.sync();\n  SearchResults<String, String> results = commands.search(searchIndexName, query);\n  return results;\n}\n')),(0,i.kt)("p",null,"Spring will now use Redis to create keys under the ",(0,i.kt)("inlineCode",{parentName:"p"},"com.redislabs.edu.redi2read.book-search")," prefix to store cache entries for the search method.\nThere is no need to perform cache maintenance yourself. Spring will intercept the request and check the cache;\nin the case of a cache hit, it will return its value. Otherwise, in case of a miss, it will store the cache\u2019s search method\u2019s return value,\nallowing the method to execute as if there was no cache at all.\nIf we try the request ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/api/books/search?q=java"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request GET 'http://localhost:8080/api/books/search?q=java'\n")),(0,i.kt)("p",null,"On the first request we get a 28 ms response time:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"PostMan Request 2",src:n(10702).Z,width:"1684",height:"1040"})),(0,i.kt)("p",null,"Subsequent responses return in the range of 8 ms to 10 ms consistently:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"PostMan Request 1",src:n(70442).Z,width:"1684",height:"1040"})))}u.isMDXComponent=!0},70442:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/image1-b14ce854155fedafbf2e5e2ae72c476c.png"},10702:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/image2-96a417f52c38a686e5b194570d9db8dc.png"}}]);