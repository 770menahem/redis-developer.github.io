"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[1698],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>p});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),h=c(n),p=r,m=h["".concat(l,".").concat(p)]||h[p]||u[p]||i;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},50358:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(67294),r=n(52263);const i="authorByline_VoxI",s="authorLabel_a70t",o="authorProfileImage_URwT";const l=function(e){let{frontMatter:t}=e;const{siteConfig:n}=(0,r.Z)(),l=n.customFields.authors;return a.createElement(a.Fragment,null,t.authors&&a.createElement("div",{className:"docAuthors"},a.createElement("hr",null),t.authors.map((e=>a.createElement("div",{key:e,className:i},a.createElement("img",{className:o,src:`/img/${l[e].image?l[e].image:"default_author_profile_pic.png"}`,alt:`Profile picture for ${l[e].name}`}),a.createElement("div",null,a.createElement("div",{className:s},"Author:"),a.createElement("div",null,a.createElement("a",{href:l[e].link,target:"_blank"},l[e].name),", ",l[e].title))))),a.createElement("hr",null)))}},73956:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var a=n(87462),r=(n(67294),n(3905)),i=n(50358);const s={id:"index-redisearch",title:"Indexing and Querying with RediSearch",sidebar_label:"RediSearch",slug:"/develop/node/nodecrashcourse/redisearch",authors:["simon"]},o=void 0,l={unversionedId:"develop/node/node-crash-course/redisearch/index-redisearch",id:"develop/node/node-crash-course/redisearch/index-redisearch",title:"Indexing and Querying with RediSearch",description:"<iframe",source:"@site/docs/develop/node/node-crash-course/redisearch/index-redisearch.mdx",sourceDirName:"develop/node/node-crash-course/redisearch",slug:"/develop/node/nodecrashcourse/redisearch",permalink:"/develop/node/nodecrashcourse/redisearch",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/develop/node/node-crash-course/redisearch/index-redisearch.mdx",tags:[],version:"current",lastUpdatedAt:1669046427,formattedLastUpdatedAt:"Nov 21, 2022",frontMatter:{id:"index-redisearch",title:"Indexing and Querying with RediSearch",sidebar_label:"RediSearch",slug:"/develop/node/nodecrashcourse/redisearch",authors:["simon"]},sidebar:"docs",previous:{title:"RedisJSON",permalink:"/develop/node/nodecrashcourse/redisjson"},next:{title:"Checkins with Streams",permalink:"/develop/node/nodecrashcourse/checkinswithstreams"}},c={},d=[{value:"Coding Exercise",id:"coding-exercise",level:2},{value:"External Resources",id:"external-resources",level:2}],u={toc:d};function h(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(i.Z,{frontMatter:s,mdxType:"Authors"}),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/HPvP_OJ7h2Q",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"We chose to store our user and location data in Redis Hashes. Hashes are a great fit for storing domain objects. Recall that we've chosen to store each user in a Hash whose key contains the user ID. For example, here's user 852 as seen in RedisInsight:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"User 852 viewed with RedisInsight",src:n(36200).Z,width:"1363",height:"824"})),(0,r.kt)("p",null,"If you're using redis-cli, you can look at user 852 with the ",(0,r.kt)("inlineCode",{parentName:"p"},"HGETALL")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'127.0.0.1:6379> hgetall ncc:users:852\n 1) "id"\n 2) "852"\n 3) "firstName"\n 4) "Dominik"\n 5) "lastName"\n 6) "Schiffmann"\n 7) "email"\n 8) "dominik.schiffmann@example.com"\n 9) "password"\n10) "$2b$05$xbkSwODz1tWqdE7xWb393eiYIQcdiEdbbvhK88.Xr9sW7WxdI26qi"\n11) "numCheckins"\n12) "9353"\n13) "lastCheckin"\n14) "1488517098363"\n15) "lastSeenAt"\n16) "124"\n')),(0,r.kt)("p",null,"Storing data in Hashes means that we can easily and efficiently retrieve the contents of the Hash, provided that we know the key. So it's trivial to look up user 852, but how can we perform any of the following operations?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Get the user whose email address is ",(0,r.kt)("inlineCode",{parentName:"li"},"dominik.schiffmann@example.com"),"."),(0,r.kt)("li",{parentName:"ul"},"Find all users that were last seen at location 124."),(0,r.kt)("li",{parentName:"ul"},"Find all the users who have between 1000 and 3000 checkins."),(0,r.kt)("li",{parentName:"ul"},"Find all locations within a 10 mile radius of a given latitude / longitude coordinate and which have at least a 3 star rating.")),(0,r.kt)("p",null,"Redis is a key/value database. This means that its data model is optimized for retrieval by key. The queries above can't be resolved by knowing just the Hash key - we need some other mechanism to index our data."),(0,r.kt)("p",null,'Traditionally in a key/value database, this has meant adding code to create and manually update indexes. For example to resolve the query "which user has the email address ',(0,r.kt)("inlineCode",{parentName:"p"},"dominik.schiffmann@example.com"),"\", we might create a new String key containing that email address, with the value being the user's ID:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.0.1:6379> set ncc:users:byemail:dominik.schiffmann@example.com 852\nOK\n")),(0,r.kt)("p",null,"Now, if we want to get Dominik's user details given only his email address, we have a two step process to follow:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Look up the user ID for the user associated with the email address we have."),(0,r.kt)("li",{parentName:"ol"},"Use that user ID to retrieve the values from the user's Hash.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'127.0.0.1:6379> get ncc:users:byemail:dominik.schiffmann@example.com\n"852"\n127.0.0.1:6379> hgetall ncc:users:852\n 1) "id"\n 2) "852"\n 3) "firstName"\n 4) "Dominik"\n 5) "lastName"\n 6) "Schiffmann"\n 7) "email"\n 8) "dominik.schiffmann@example.com"\n 9) "password"\n10) "$2b$05$xbkSwODz1tWqdE7xWb393eiYIQcdiEdbbvhK88.Xr9sW7WxdI26qi"\n11) "numCheckins"\n12) "9353"\n13) "lastCheckin"\n14) "1488517098363"\n15) "lastSeenAt"\n16) "124"\n')),(0,r.kt)("p",null,"We'd also need to keep this information up to date and in sync with changes to the Hash at ",(0,r.kt)("inlineCode",{parentName:"p"},"ncc:users:852")," ourselves in our application code."),(0,r.kt)("p",null,"Other sorts of secondary indexes can be created using other Redis data types. For example, we might ",(0,r.kt)("a",{parentName:"p",href:"https://redis.io/topics/indexes"},"use a Redis Sorted Set as a secondary index"),', allowing us to perform range queries such as "Find all the users who have between 1000 and 3000 checkins". Again, we\'d have to populate and maintain this extra data structure ourselves in the application code.'),(0,r.kt)("p",null,'The RediSearch module solves all of these problems for us and more. It is an indexing, querying and full-text search engine for Redis that automatically keeps track of changes to data in indexed Hashes. RediSearch provides a flexible query language to answer questions such as "Find me all the gyms with at least a 3 star rating and more than 200 checkins within 10 miles of Oakland, California" without adding code to build or maintain secondary data structures in our application.'),(0,r.kt)("p",null,"Watch the video to see how RediSearch is used in our example Node.js application."),(0,r.kt)("h2",{id:"coding-exercise"},"Coding Exercise"),(0,r.kt)("p",null,"In this exercise, you'll finish implementing a route that uses RediSearch to return all users whose last checkin was at a given location."),(0,r.kt)("p",null,"Open the ",(0,r.kt)("inlineCode",{parentName:"p"},"node-js-crash-course")," folder with your IDE, and find the file ",(0,r.kt)("inlineCode",{parentName:"p"},"src/routes/user_routes.js"),"."),(0,r.kt)("p",null,"In this file, you'll see a partly implemented route ",(0,r.kt)("inlineCode",{parentName:"p"},"/users/at/:locationId"),". To complete this exercise, you'll need to replace this line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const searchResults = await redis.performSearch(\n  redis.getKeyName('usersidx'),\n  'TODO... YOUR QUERY HERE',\n);\n")),(0,r.kt)("p",null,'with one containing the correct RediSearch query to return users whose "lastSeenAt" field is set to the value of locationId. You\'ll need to use the "numeric range" syntax for this, as the "lastSeenAt" field was indexed as a number. Be sure to check out the ',(0,r.kt)("a",{parentName:"p",href:"https://redis.io/docs/stack/search/reference/query_syntax/"},"Query Syntax documentation")," for RediSearch to get help with this."),(0,r.kt)("p",null,"To try your code, ensure that the API Server component is running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"$ npm run dev\n")),(0,r.kt)("p",null,"(remember, this will use nodemon to restart the server any time you save a code change)."),(0,r.kt)("p",null,"Then, point your browser at ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:8081/api/users/at/33"),". If your query is correct, you should see output similar to the following (actual users may differ, just ensure that the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"lastSeenAt")," for each matches the location ID you provided - 33 in this case):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": "238",\n    "firstName": "Jonas",\n    "lastName": "Nielsen",\n    "numCheckins": "7149",\n    "lastCheckin": "1515248028256",\n    "lastSeenAt": "33"\n  },\n  {\n    "id": "324",\n    "firstName": "Frans",\n    "lastName": "Potze",\n    "numCheckins": "8623",\n    "lastCheckin": "1515976232073",\n    "lastSeenAt": "33"\n  },\n  ...\n]\n')),(0,r.kt)("p",null,"To help you develop your query, use the RediSearch view in RedisInsight, or the FT.SEARCH command in redis-cli. Here's an example of how to enter a query with RedisInsight (I'm looking for users with the first name \"Laura\"):"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"RediSearch Query Example",src:n(60822).Z,width:"1375",height:"730"})),(0,r.kt)("p",null,"Remember to select the ",(0,r.kt)("inlineCode",{parentName:"p"},"ncc:usersidx")," index, as you're working with users data here."),(0,r.kt)("h2",{id:"external-resources"},"External Resources"),(0,r.kt)("p",null,"Querying, Index, and Full-Text Search in Redis:"),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/B10nHEdW3NA",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"Finding Bigfoot RESTfuly with Express + RediSearch:"),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/eJFwsNfi_MI",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"Other resources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://university.redis.com/courses/ru203/"},"RU203, Querying, Indexing, and Full-Text Search")," at Redis University"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redisearch.io/"},"RediSearch"),", official home page"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/RediSearch/redisearch-getting-started"},"RediSearch Getting Started Tutorial"))))}h.isMDXComponent=!0},36200:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/insight_user_852-a8c42050d96696573fac10e960edb705.png"},60822:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/redisearch_redis_insight-3d7b8c7eb4f04839f36ddfced33c908c.png"}}]);