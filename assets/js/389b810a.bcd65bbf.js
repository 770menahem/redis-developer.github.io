"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[8760],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),u=d(a),h=i,c=u["".concat(l,".").concat(h)]||u[h]||p[h]||r;return a?n.createElement(c,o(o({ref:t},m),{},{components:a})):n.createElement(c,o({ref:t},m))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},77455:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));const r={id:"index-create",title:"3. Create Index",sidebar_label:"3. Create Index",slug:"/howtos/moviesdatabase/create"},o=void 0,s={unversionedId:"howtos/moviesdatabase/create/index-create",id:"howtos/moviesdatabase/create/index-create",title:"3. Create Index",description:"Before creating the index let's describe the dataset and insert entries.",source:"@site/docs/howtos/moviesdatabase/create/index-create.mdx",sourceDirName:"howtos/moviesdatabase/create",slug:"/howtos/moviesdatabase/create",permalink:"/howtos/moviesdatabase/create",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/moviesdatabase/create/index-create.mdx",tags:[],version:"current",lastUpdatedAt:1686322018,formattedLastUpdatedAt:"Jun 9, 2023",frontMatter:{id:"index-create",title:"3. Create Index",sidebar_label:"3. Create Index",slug:"/howtos/moviesdatabase/create"},sidebar:"docs",previous:{title:"2. Install Redis Stack",permalink:"/howtos/moviesdatabase/install"},next:{title:"4. Query Data",permalink:"/howtos/moviesdatabase/query"}},l={},d=[{value:"Sample Dataset",id:"sample-dataset",level:2},{value:"Key and Data structure",id:"key-and-data-structure",level:3},{value:"Insert Movies",id:"insert-movies",level:2},{value:"Search &amp; Indexing",id:"search--indexing",level:2},{value:"Create the Index",id:"create-the-index",level:3}],m={toc:d};function p(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Before creating the index let's describe the dataset and insert entries."),(0,i.kt)("h2",{id:"sample-dataset"},"Sample Dataset"),(0,i.kt)("p",null,"In this project you will use a simple dataset describing movies, for now, all records are in English. You will learn more about other languages in another tutorial."),(0,i.kt)("p",null,"A movie is represented by the following attributes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"movie_id"))," : The unique ID of the movie, internal to this database"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"title"))," : The title of the movie."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"plot"))," : A summary of the movie."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"genre"))," : The genre of the movie, for now a movie will only have a single genre."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"release_year"))," : The year the movie was released as a numerical value."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"rating"))," : A numeric value representing the public's rating for this movie."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"votes"))," : Number of votes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"poster"))," : Link to the movie poster."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"imdb_id"))," : id of the movie in the ",(0,i.kt)("a",{parentName:"li",href:"https://imdb.com"},"IMDB")," database.")),(0,i.kt)("h3",{id:"key-and-data-structure"},"Key and Data structure"),(0,i.kt)("p",null,"As a Redis developer, one of the first things to look when building your application is to define the structure of the key and data (data design/data modeling)."),(0,i.kt)("p",null,"A common way of defining the keys in Redis is to use specific patterns in them. For example in this application where the database will probably deal with various business objects: movies, actors, theaters, users, ... we can use the following pattern:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"business_object:key"))),(0,i.kt)("p",null,"For example:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"movie:001")," for the movie with the id 001"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"user:001")," the user with the id 001")),(0,i.kt)("p",null,"and for the movies information you should use a Redis ",(0,i.kt)("a",{parentName:"p",href:"https://redis.io/topics/data-types#hashes"},"Hash"),"."),(0,i.kt)("p",null,"A Redis Hash allows the application to structure all the movie attributes in individual fields; also Redis Stack will index the fields based on the index definition."),(0,i.kt)("h2",{id:"insert-movies"},"Insert Movies"),(0,i.kt)("p",null,"It is time now to add some data into your database, let's insert a few movies, using ",(0,i.kt)("inlineCode",{parentName:"p"},"redis-cli")," or ",(0,i.kt)("a",{parentName:"p",href:"https://redis.com/redis-enterprise/redis-insight/"},"RedisInsight"),"."),(0,i.kt)("p",null,"Once you are connected to your Redis instance run the following commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n> HSET movie:11002 title "Star Wars: Episode V - The Empire Strikes Back" plot "After the Rebels are brutally overpowered by the Empire on the ice planet Hoth, Luke Skywalker begins Jedi training with Yoda, while his friends are pursued by Darth Vader and a bounty hunter named Boba Fett all over the galaxy." release_year 1980 genre "Action" rating 8.7 votes 1127635 imdb_id tt0080684\n\n> HSET movie:11003 title "The Godfather" plot "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son." release_year 1972 genre "Drama" rating 9.2 votes 1563839 imdb_id tt0068646\n\n> HSET movie:11004 title "Heat" plot "A group of professional bank robbers start to feel the heat from police when they unknowingly leave a clue at their latest heist." release_year 1995 genre "Thriller" rating 8.2 votes 559490 imdb_id tt0113277\n\n> HSET "movie:11005" title "Star Wars: Episode VI - Return of the Jedi" genre "Action" votes 906260 rating 8.3 release_year 1983  plot "The Rebels dispatch to Endor to destroy the second Empire\'s Death Star." ibmdb_id "tt0086190"\n\n')),(0,i.kt)("p",null,"Now it is possible to get information from the hash using the movie ID. For example if you want to get the title, and rating execute the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> HMGET movie:11002 title rating\n\n1) "Star Wars: Episode V - The Empire Strikes Back"\n2) "8.7"\n')),(0,i.kt)("p",null,"And you can increment the rating of this movie using:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> HINCRBYFLOAT movie:11002 rating 0.1\n"8.8"\n')),(0,i.kt)("p",null,"But how do you get a movie or list of movies by year of release, rating or title?"),(0,i.kt)("p",null,"One option, would be to read all the movies, check all fields and then return only matching movies; no need to say that this is a really bad idea."),(0,i.kt)("p",null,"Nevertheless this is where Redis developers often create custom secondary indexes using SET/SORTED SET structures that point back to the movie hash. This needs some heavy design and implementation."),(0,i.kt)("p",null,"This is where Search and Query in Redis Stack can help, and why it was created."),(0,i.kt)("h2",{id:"search--indexing"},"Search & Indexing"),(0,i.kt)("p",null,"Redis Stack greatly simplifies this by offering a simple and automatic way to create secondary indices on Redis Hashes. (more datastructure will eventually come)"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://github.com/RediSearch/redisearch-getting-started/blob/master/docs/images/secondary-index.png?raw=true",alt:"Secondary Index"})),(0,i.kt)("p",null,"When using Redis Stack, if you want to query on a field, you must first index that field. Let's start by indexing the following fields for our movies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Title"),(0,i.kt)("li",{parentName:"ul"},"Release Year"),(0,i.kt)("li",{parentName:"ul"},"Rating"),(0,i.kt)("li",{parentName:"ul"},"Genre")),(0,i.kt)("p",null,"When creating a index you define:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"which data you want to index: all ",(0,i.kt)("em",{parentName:"li"},"hashes")," with a key starting with ",(0,i.kt)("inlineCode",{parentName:"li"},"movies")),(0,i.kt)("li",{parentName:"ul"},"which fields in the hashes you want to index using a Schema definition.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Warning: Do not index all fields"))),(0,i.kt)("p",{parentName:"blockquote"},"Indexes take space in memory, and must be updated when the primary data is updated. So create the index carefully and keep the definition up to date with your needs.")),(0,i.kt)("h3",{id:"create-the-index"},"Create the Index"),(0,i.kt)("p",null,"Create the index with the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> FT.CREATE idx:movie ON hash PREFIX 1 "movie:" SCHEMA title TEXT SORTABLE release_year NUMERIC SORTABLE rating NUMERIC SORTABLE genre TAG SORTABLE\n')),(0,i.kt)("p",null,"Before running some queries let's look at the command in detail:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://oss.redis.com/redisearch/master/Commands/#ftcreate"},(0,i.kt)("inlineCode",{parentName:"a"},"FT.CREATE"))," : creates an index with the given spec. The index name will be used in all the key names so keep it short."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"idx:movie")," : the name of the index"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ON hash")," : the type of structure to be indexed."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'PREFIX 1 "movie:"')," : the prefix of the keys that should be indexed. This is a list, so since we want to only index movie:","*"," keys the number is 1. Suppose you want to index movies and tv_show that have the same fields, you can use: ",(0,i.kt)("inlineCode",{parentName:"li"},'PREFIX 2 "movie:" "tv_show:"')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SCHEMA ..."),": defines the schema, the fields and their type, to index, as you can see in the command, we are using ",(0,i.kt)("a",{parentName:"li",href:"https://oss.redis.com/redisearch/Query_Syntax/#a_few_query_examples"},"TEXT"),", ",(0,i.kt)("a",{parentName:"li",href:"https://oss.redis.com/redisearch/Query_Syntax/#numeric_filters_in_query"},"NUMERIC")," and ",(0,i.kt)("a",{parentName:"li",href:"https://oss.redis.com/redisearch/Query_Syntax/#tag_filters"},"TAG"),", and ",(0,i.kt)("a",{parentName:"li",href:"https://oss.redis.com/redisearch/Sorting/"},"SORTABLE")," parameters.")),(0,i.kt)("p",null,"You can find information about the ",(0,i.kt)("a",{parentName:"p",href:"https://oss.redis.com/redisearch/Commands/#ftcreate"},"FT.CREATE")," command in the ",(0,i.kt)("a",{parentName:"p",href:"https://oss.redis.com/redisearch/Commands/#ftcreate"},"documentation"),"."),(0,i.kt)("p",null,"You can look at the index information with the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"> FT.INFO idx:movie\n")))}p.isMDXComponent=!0}}]);