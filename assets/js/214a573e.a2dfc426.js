"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[6973],{3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return f}});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(r),f=a,h=u["".concat(l,".").concat(f)]||u[f]||d[f]||i;return r?n.createElement(h,s(s({ref:t},c),{},{components:r})):n.createElement(h,s({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},94233:function(e,t,r){r.r(t),r.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return d}});var n=r(87462),a=r(63366),i=(r(67294),r(3905)),s=(r(44996),["components"]),o={id:"index-exercise",title:"2.2 Exercise: Saving a Snapshot",sidebar_label:"2.2 Exercise: Saving a Snapshot",slug:"/operate/redis-at-scale/persistence-and-durability/exercise",custom_edit_url:null},l=void 0,p={unversionedId:"operate/redis-at-scale/persistence-and-durability/exercise/index-exercise",id:"operate/redis-at-scale/persistence-and-durability/exercise/index-exercise",title:"2.2 Exercise: Saving a Snapshot",description:"As we learned in the previous unit, Redis will save a snapshot of your database every hour if at least one key has changed, every five minutes if at least 100 keys have changed, or every 60 seconds if at least 10000 keys have changed.",source:"@site/docs/operate/redis-at-scale/persistence-and-durability/exercise/index-exercise.mdx",sourceDirName:"operate/redis-at-scale/persistence-and-durability/exercise",slug:"/operate/redis-at-scale/persistence-and-durability/exercise",permalink:"/operate/redis-at-scale/persistence-and-durability/exercise",draft:!1,editUrl:null,tags:[],version:"current",lastUpdatedAt:1655485542,formattedLastUpdatedAt:"6/17/2022",frontMatter:{id:"index-exercise",title:"2.2 Exercise: Saving a Snapshot",sidebar_label:"2.2 Exercise: Saving a Snapshot",slug:"/operate/redis-at-scale/persistence-and-durability/exercise",custom_edit_url:null},sidebar:"docs",previous:{title:"2.1 Persistence options in Redis'",permalink:"/operate/redis-at-scale/persistence-and-durability/persistence-options-in-redis"},next:{title:"3.0 Introduction to High Availability",permalink:"/operate/redis-at-scale/high-availability/introduction"}},c={},d=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2}],u={toc:d};function f(e){var t=e.components,r=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"As we learned in the previous unit, Redis will save a snapshot of your database every hour if at least one key has changed, every five minutes if at least 100 keys have changed, or every 60 seconds if at least 10000 keys have changed."),(0,i.kt)("p",null,"Let\u2019s update this to a simplified hypothetical scenario where we want to save a snapshot if three keys have been modified in 20 seconds."),(0,i.kt)("h2",{id:"step-1"},"Step 1"),(0,i.kt)("p",null,"Create a directory named 2.2 and in it prepare a ",(0,i.kt)("inlineCode",{parentName:"p"},"redis.conf")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ mkdir 2.2\n$ cd 2.2\n$ vim redis.conf\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"redis.conf")," file should specify a filename that will be used for the rdb file and a directive that will trigger the creation of a snapshot if 3 keys have been modified in 20 seconds, as described above."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"dbfilename my_backup_file.rdb\nsave 20 3\n")),(0,i.kt)("h2",{id:"step-2"},"Step 2"),(0,i.kt)("p",null,"In the 2.2 directory, start a Redis server - passing it the ",(0,i.kt)("inlineCode",{parentName:"p"},"redis.conf")," configuration file you just created."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ redis-server ./redis.conf\n")),(0,i.kt)("p",null,"In a separate terminal tab use the ",(0,i.kt)("inlineCode",{parentName:"p"},"redis-cli")," to create three random keys, one after the other. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.0.1:6379> SET a 1\n127.0.0.1:6379> SET b 2\n127.0.0.1:6379> SET c 3\n")),(0,i.kt)("p",null,"Run the ",(0,i.kt)("inlineCode",{parentName:"p"},"ls")," command in the first terminal to list all the files in the 2.2 directory. What changed?"),(0,i.kt)("h2",{id:"step-3"},"Step 3"),(0,i.kt)("p",null,"Now we\u2019re ready to take our persistence a level higher and set up an ",(0,i.kt)("inlineCode",{parentName:"p"},"AOF")," file. Modify your ",(0,i.kt)("inlineCode",{parentName:"p"},"redis.conf")," file so that the server will log every new write command and force writing it to disk."),(0,i.kt)("p",null,"Be careful! We have a running server and we want this configuration to be applied without restarting it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.0.1:6379> CONFIG SET appendonly yes\n127.0.0.1:6379> CONFIG SET appendfsync always\n")),(0,i.kt)("p",null,"In order for these settings to be persisted to the ",(0,i.kt)("inlineCode",{parentName:"p"},"redis.conf")," file we need to save them:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.0.1:6379> CONFIG REWRITE\n")),(0,i.kt)("h2",{id:"step-4"},"Step 4"),(0,i.kt)("p",null,"Create a few random keys through ",(0,i.kt)("inlineCode",{parentName:"p"},"redis-cli"),". Check the contents of the directory 2.2 again. What changed?"),(0,i.kt)("h2",{id:"step-5"},"Step 5"),(0,i.kt)("p",null,"As a final step, restart the Redis server process (you can press Ctrl+C in the terminal to stop the process and re-run it again). If you run the ",(0,i.kt)("inlineCode",{parentName:"p"},"SCAN 0")," command you will see that all the keys you created are still in the database, even though we restarted the process."))}f.isMDXComponent=!0}}]);