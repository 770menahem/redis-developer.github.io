<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Redis Developer Hub Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Redis Developer Hub Blog Atom Feed">
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-W8Z6BLQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><title data-react-helmet="true">How to build a Fraud Detection System using RedisGears and RedisBloom | Redis Developer Hub</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="/img/share.png"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to build a Fraud Detection System using RedisGears and RedisBloom | Redis Developer Hub"><meta data-react-helmet="true" name="description" content="Imagine that your ads are generating a lot of traffic, but you are not seeing enough results from your ad spend. Fraudsters often try to steal digital ad marketing budgets through various sophisticated mechanisms. Faking clicks can make it appear as though a real user was engaging with the ad, but in reality when these fake clicks drive installs, the cost of the install goes to the fraudster’s pocket. With companies willing to spend a huge amount of money on digital advertisements, the number of fraudsters in ad markets are also increasing."><meta data-react-helmet="true" property="og:description" content="Imagine that your ads are generating a lot of traffic, but you are not seeing enough results from your ad spend. Fraudsters often try to steal digital ad marketing budgets through various sophisticated mechanisms. Faking clicks can make it appear as though a real user was engaging with the ad, but in reality when these fake clicks drive installs, the cost of the install goes to the fraudster’s pocket. With companies willing to spend a huge amount of money on digital advertisements, the number of fraudsters in ad markets are also increasing."><meta data-react-helmet="true" property="og:url" content="https://developer.redislabs.com/howtos/frauddetection"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://fonts.gstatic.com"><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&amp;family=Roboto+Mono:wght@400;500;600;700&amp;display=swap" rel="stylesheet"><link data-react-helmet="true" rel="canonical" href="https://developer.redislabs.com/howtos/frauddetection"><link rel="stylesheet" href="/styles.a3ecb235.css">
<link rel="stylesheet" href="/main.8cbeb264.css">
<link rel="preload" href="/styles.87043692.js" as="script">
<link rel="preload" href="/runtime~main.d23adef3.js" as="script">
<link rel="preload" href="/main.b9d6792e.js" as="script">
<link rel="preload" href="/1.58090a60.js" as="script">
<link rel="preload" href="/2.1345fa61.js" as="script">
<link rel="preload" href="/3.3cc4be76.js" as="script">
<link rel="preload" href="/1be78505.e53aa30e.js" as="script">
<link rel="preload" href="/935f2afb.dae174ed.js" as="script">
<link rel="preload" href="/17896441.4490e95e.js" as="script">
<link rel="preload" href="/6c249fdd.9458d461.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W8Z6BLQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg width="24" height="18" xmlns="http://www.w3.org/2000/svg"><g stroke="#FFFFFF" stroke-width="1.65" fill="none" fill-rule="evenodd" stroke-dasharray="4.4" stroke-linecap="round" stroke-linejoin="round"><path d="M1 16.95h24.2M1 9.25h24.2M1 1.55h24.2"></path></g></svg></div><a class="navbar__brand" href="/"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/create/rediscloud">Get started</a><a href="https://redislabs.com/try-free/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Try Free</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo-1.png" alt="Redis Developer Hub logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/create/rediscloud">Get started</a></li><li class="menu__list-item"><a href="https://redislabs.com/try-free/" target="_blank" rel="noopener noreferrer" class="menu__link">Try Free</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">How to build a Fraud Detection System using RedisGears and RedisBloom</h1></header><div class="markdown"><p>Imagine that your ads are generating a lot of traffic, but you are not seeing enough results from your ad spend. Fraudsters often try to steal digital ad marketing budgets through various sophisticated mechanisms. Faking clicks can make it appear as though a real user was engaging with the ad, but in reality when these fake clicks drive installs, the cost of the install goes to the fraudster’s pocket. With companies willing to spend a huge amount of money on digital advertisements, the number of fraudsters in ad markets are also increasing.</p><p><img alt="fraud detection" src="/assets/images/fraud_grafana-c31c5ae1d7e724d14a7bbd7c5b134707.png"></p><p>This blog post will show a simplified version of such a use case to demonstrate how real-time fraud detection works—so that you can understand how to stay ahead of the fraudsters.</p><p>Here’s what we have used:</p><ul><li>Python-based fraud detector module which performs two kinds of fraud checks : IP blacklisting &amp; Click spamming</li><li>IP blacklisting uses Redis Cuckoo Filter from Redis Bloom package.</li><li>Click Spamming uses Redis Sorted set.</li><li>The data is then pushed to Redis Stream which is consumed by Redis Gears for processing</li><li>RedisTimeseries gets updated and Redis Data source for Grafana displays the dashboard</li></ul><p><img alt="Fraud Detection" src="/assets/images/fraud_architecture-3782e42b849cc06dab6a9f4ecd4f9784.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-1-installing-docker"></a>Step #1: Installing Docker<a class="hash-link" href="#step-1-installing-docker" title="Direct link to heading">#</a></h3><p>You can follow <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/get-docker/</a> to get Docker installed on your local system.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-2-get-ready-to-redis"></a>Step #2: Get Ready to Redis<a class="hash-link" href="#step-2-get-ready-to-redis" title="Direct link to heading">#</a></h3><p>You will need a Redis server up and running on your local machine. You can use the below CLI to bring up Redis server with RedisGears</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -d -p 6379:6379 redislabs/redismod</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The command will pull the image from redis docker repo and start the redis server with all the required modules, the logs ends like this.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-3-cloning-the-repository"></a>Step #3: Cloning the Repository<a class="hash-link" href="#step-3-cloning-the-repository" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone https://github.com/redis-developer/redis-datasets.git</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-4-building-and-running-the-docker-container"></a>Step #4: Building and Running the Docker Container<a class="hash-link" href="#step-4-building-and-running-the-docker-container" title="Direct link to heading">#</a></h3><p>Change directory to fraud-detection</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd redis-datasets/use-cases/fraud-detection</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The code is present in use-cases/fraud-detection. The app is dockerized with necessary packages (including client packages for redis modules). </p><p>Create the image using the command</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker build -t redis-fraud:latest .</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Create the container using the command:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -e REDIS_HOST=&#x27;&lt;host&gt;&#x27; -e REDIS_PORT=6379 -p 5000:5000 -d redis-fraud</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You will get the container Id, which can be used to tail application logs.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker logs -f &lt;container-id&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you are using redismod image to run redis locally, please provide the IP of the host machine (and not localhost or 127.0.0.1).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-5--verifying-the-application"></a>Step #5:  Verifying the Application<a class="hash-link" href="#step-5--verifying-the-application" title="Direct link to heading">#</a></h3><p>Let&#x27;s take a look at how connections are managed in this project.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import redis</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from redisbloom.client import Client</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from singleton_decorator import singleton</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@singleton</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class RedisConn:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def __init__(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        host = os.getenv(&quot;REDIS_HOST&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        port = os.getenv(&quot;REDIS_PORT&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if not host or not port:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            raise Exception(&quot;No Redis Host or Port provided. Please provide Host and Port in docker run command as env&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        port = int(port)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        self.redis_client = redis.Redis(host=host, port=port)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        self.bloom_client = Client(host=host, port=port)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def redis(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return self.redis_client</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def bloom(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return self.bloom_client</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In line 2, we import the redis package for package. All the core Redis commands are available in this redis package.
In line 4, we import the redisbloom package. Since Redis Bloom is a module, the clients used to interact with this module are also different. We will see more such examples below.
The singleton_decorator ensures only one instance of this connection class is created, and os package is used to read the environment variables to form the connection.</p><p>Now let’s take a look at how we use Redis to solve click spamming and IP fraud.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def ip_fraud(self, data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     exists = RedisConn().bloom().cfExists(Constants.IP_CUCKOO_FILTER_NAME, data[&#x27;ip&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     if exists:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         data[&#x27;fraud_type&#x27;] = Constants.IP_BLACKLIST</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         data[&#x27;status&#x27;] = Constants.FRAUD</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     return exists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def click_spam(self, data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    is_click_spammed = False</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    count = RedisConn().redis().zcount(data.get(&#x27;device_id&#x27;), data[&#x27;ts&#x27;] - self.click_spam_window_in_sec, data[&#x27;ts&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if count &gt;= self.click_spam_threshold:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         is_click_spammed = True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         data[&#x27;fraud_type&#x27;] = Constants.CLICK_SPAM</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         data[&#x27;status&#x27;] = Constants.FRAUD</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return is_click_spammed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def publish(self, data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    RedisConn().redis().xadd(Constants.STREAM_NAME, data, id=&#x27;*&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In the above code, Cuckoo Filter to find blacklisted IP fraud. Cuckoo filter is a probabilistic data structure, part of the module redisbloom. Checking for existence of IP in cuckoo filter is done using cfExists method provided by bloom client. Please note that Cuckoo filter can return false positives. To configure the error rate, cf.reserve command can be used to create the filter and custom bucket size can be provided.</p><p>To identify click spam, we use the zcount method of sorted sets provided in redis package.
Using zcount, we find the number of clicks from a device in a certain pre configured window. If the count received is greater than a certain threshold, we identify it as anomalous.</p><p>Finally, data is pushed to the redis stream using the xadd command. id=’*’ indicates Redis stream to generate a unique id for our message.</p><p>Registering Gears:
When the app comes up, a gear is registered which reacts to the stream to which we push data.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from gearsclient import GearsRemoteBuilder as GearsBuilder</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from redistimeseries.client import Client</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def stream_handler(item):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  data = item[&#x27;value&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  member = json.dumps(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {&#x27;device_id&#x27;: data[&#x27;device_id&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;transaction_id&#x27;: data[&#x27;transaction_id&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;ts&#x27;: data[&#x27;ts&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  redis.Redis().zadd(data.get(&#x27;device_id&#x27;), {member: data[&#x27;ts&#x27;]})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Client().incrby(data[&#x27;fraud_type&#x27;], 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GearsBuilder(reader=&#x27;StreamReader&#x27;, r=redis_conn, requirements=[&quot;redis&quot;, &quot;redistimeseries&quot;]).foreach(stream_handler).register(&#x27;data_stream&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As mentioned before, since Redis Gears and Redis TimeSeries are modules, we need to use the clients provided in their respective packages.
We use the GearsRemoteBuilder class to build the Gear. StreamReader ensures that the stream_handler function is executed for every new message from the stream. The stream_handler adds the data to the sorted set using zadd (This information is used in zcount to identify click_spam)  and increments the count of time series for clean and fraud types using incrby of the redis time series module, which is later used for visualization.</p><p><img alt="Fraud Detection" src="/assets/images/fraud_redisinsight-c574d1328522e820b8156532ffcab001.png"></p><p>Gear registration can be checked on Redis Insights as well.</p><p>Finally the flask app which exposes the end point for trigger.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from flask import Flask, request</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from fraud_checks import FraudChecks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from setup import Setup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">app = Flask(__name__)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@app.route(&#x27;/&#x27;, methods=[&#x27;POST&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def check_fraud():</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        response = FraudChecks().check_fraud(request.get_json())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        code = 200</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    except Exception as e:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        print(&quot;Error occurred &quot;, e)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        response = str(e)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        code = 500</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return response, code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Setup().init()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app.run(port=5000, debug=False, host=&#x27;0.0.0.0&#x27;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The app is exposed on port 5000, before starting the server, init method of setup is called to register the gear.
The endpoint calls the function that does the fraud checks and returns the response.</p><p>The application is written in python and exposes an endpoint which accepts a few parameters. Use the below command to invoke the application:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ curl --request POST &#x27;localhost:5000&#x27; --header &#x27;Content-Type: application/json&#x27; --data-raw &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;device_id&quot;: &quot;111-000-000&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;ip&quot;: &quot;1.1.1.1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;transaction_id&quot;: &quot;3e4fad5fs&quot;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clean</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Since initially no data is available in cuckoo filter, all IPs will be allowed through.
To add data to cuckoo filter connect to redis using cli and run the command</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cf.addnx ip_cf 1.1.1.1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Run the post command with this IP again, this time, the result will be ‘ip_blacklist’.</p><p><img alt="Fraud Detection" src="/assets/images/fraud_ipblacklist-f4e8d0d5f13f4f52fcc23d8061d08089.png"></p><p>Click Spamming:</p><p>The app is configured to allow 2 events in a window of 10 seconds from the same device. To verify, make more than 2 curl requests within 10 seconds and the result will be ‘click_spam’</p><p><img alt="Fraud Detection" src="/assets/images/fraud_clickspam-21ecfdd1c5631fbcffa57463bff679c1.png"></p><p>Optional: The following variables can be configured during the ‘docker run’ command.
-e CLICK_SPAM_THRESHOLD=3 -e CLICK_SPAM_WINDOW_IN_SEC=10</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="step-6-deploy-grafana"></a>Step #6: Deploy Grafana<a class="hash-link" href="#step-6-deploy-grafana" title="Direct link to heading">#</a></h3><p>It’s exciting to see the fraud detection  plotted in Grafana. To implement this, run the command below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -d -e &quot;GF_INSTALL_PLUGINS=redis-app&quot; -p 3000:3000 grafana/grafana</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Point your browser to https://&lt;IP_ADDRESS&gt;:3000. Use “admin” as username and password to log in to the Grafana dashboard.</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana1-8633ce89081d060c7d0f9774a8732171.png"></p><p>Login as ‘admin’ with password as ‘admin’, you can reset the password after your first login.</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana2-3edda1e9dbc167695911896f5b645078.png"></p><p>Click on the gear icon on the left panel (Configuration) and choose Data Sources</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana3-db89018dffb79eb941d52728211333ff.png"></p><p>Choose ‘Add data Source’</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana4-0e5c1910e791d875c4c905a231b2f1e0.png"></p><p>Search for Redis and choose Redis Data Source.</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana5-78a7bd37e9b3f2ed47ccd17df04f7506.png"></p><p>Copy and paste the raw json content from <a href="https://github.com/redis-developer/redis-datasets/blob/master/use-cases/fraud-detection/Fraud-Stats-Grafana.json" target="_blank" rel="noopener noreferrer">here</a>  in the ‘Import via panel json’ box. Click on Load.</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana6-1b09f5cf1b5ea3e4a62c22c31d3d2ce8.png"></p><p>This creates a dashboard ‘Fraud Stats’. If you get an error while importing the dashboard, try changing the name and UUID of the dashboard.</p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana7-7b495232868383fa497fe1adcb127677.png"></p><p><img alt="Fraud detection" src="/assets/images/fraud_grafana8-417135e60aef78100d604f1c5da63e5e.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="conclusion--future-work"></a>Conclusion &amp; Future Work<a class="hash-link" href="#conclusion--future-work" title="Direct link to heading">#</a></h3><ul><li>If we consider the entire flow starting from fraud check, to event streaming to data processing to visualization (using insights), all of this would have required multiple components and extensive orchestration. With Redis Ecosystem, most of this is removed.</li><li>This is just the beginning of more checks that can be done on events. A lot of other checks can be done using modules and data structures . For example: Redis provides Geospatial data structure built over sorted sets. Since latitude and longitude can be derived from IP using IP to location conversion providers, a lot of insight can be derived on whether the event can be fraudulent or not.</li><li>To reject servicing requests altogether, the redis-cell module to rate limit requests against a key can be used.</li><li>Redis AI and neural-redis can be used to build to improve efficiency of identifying fraud based.</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/frauddetection/index-frauddetection.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1-installing-docker" class="table-of-contents__link">Step #1: Installing Docker</a></li><li><a href="#step-2-get-ready-to-redis" class="table-of-contents__link">Step #2: Get Ready to Redis</a></li><li><a href="#step-3-cloning-the-repository" class="table-of-contents__link">Step #3: Cloning the Repository</a></li><li><a href="#step-4-building-and-running-the-docker-container" class="table-of-contents__link">Step #4: Building and Running the Docker Container</a></li><li><a href="#step-5--verifying-the-application" class="table-of-contents__link">Step #5:  Verifying the Application</a></li><li><a href="#step-6-deploy-grafana" class="table-of-contents__link">Step #6: Deploy Grafana</a></li><li><a href="#conclusion--future-work" class="table-of-contents__link">Conclusion &amp; Future Work</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><svg width="785" height="158" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="shape"><defs><path d="M786.344 392.459c-41.822 22.164-258.313 110.84-305.056 135.477-46.742 24.637-72.163 23.812-108.246 6.57-36.082-17.24-267.334-111.664-309.156-131.377-41.822-19.713-42.642-33.657-1.64-49.271C103.25 338.265 332.86 247.94 381.243 229.875c48.383-18.065 65.604-18.065 106.605-2.473 41.003 15.614 256.674 100.996 297.676 115.785 41.002 14.791 42.642 27.912.82 49.273v-.001z" id="a"></path><mask id="b" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="785" height="331" fill="#fff"><use xlink:href="#a"></use></mask></defs><use mask="url(#b)" xlink:href="#a" transform="translate(-32 -216)" stroke="#465282" stroke-width="4" fill="none" fill-rule="evenodd" stroke-dasharray="3.637"></use></svg><img src="/img/code-2.png" class="code" alt=""><div class="row"><div class="col col--3"><div class="footer__logo-ctr"><span class="footer__logo-tagline">Made with &lt;/&gt; by</span><a href="https://redislabs.com/" target="_blank" rel="noopener" class="footerLogoLink_3L_r"><img loading="lazy" class="footer__logo" alt="Redis Labs logo" src="/img/redis-labs-logo-reversed.svg"></a></div></div><div class="col col--9"><div class="row footer__links"><div class="col col--4 footer__col"><h4 class="footer__title">Get Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/create/rediscloud">Create Database</a></li><li class="footer__item"><a class="footer__link-item" href="/develop/">Develop</a></li><li class="footer__item"><a class="footer__link-item" href="/explore/redisinsight/">Explore your data</a></li><li class="footer__item"><a href="https://redislabs.com/redis-best-practices/introduction/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Best Practices</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/howtos/redisearch/">Build with Redis Modules</a></li></ul></div><div class="col col--4 footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a href="https://redislabs.com/community/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li><li class="footer__item"><a href="https://university.redislabs.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Redis University</a></li><li class="footer__item"><a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer" class="footer__link-item">Command Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/howtos/moviesdatabase/getting-started">How-tos &amp; tutorials</a></li></ul></div></div></div></div><div class="footer__copyright">Copyright: © 2021 Redis Labs. Redis and the cube logo are registered trademarks of Redis Labs Ltd.</div></div></footer></div>
<script src="/styles.87043692.js"></script>
<script src="/runtime~main.d23adef3.js"></script>
<script src="/main.b9d6792e.js"></script>
<script src="/1.58090a60.js"></script>
<script src="/2.1345fa61.js"></script>
<script src="/3.3cc4be76.js"></script>
<script src="/1be78505.e53aa30e.js"></script>
<script src="/935f2afb.dae174ed.js"></script>
<script src="/17896441.4490e95e.js"></script>
<script src="/6c249fdd.9458d461.js"></script>
</body>
</html>